# SINTRAN III Monitor Call: DataTransfer
# Octal: 131B
# Extracted from: Monitor Calls.md (ND-860228.2 EN)

octal: "131B"
name: "DataTransfer"
short_names:
  - "DATATRANSFER"
  - "DXABS"

description: |
  Transfers data between physical memory and a mass-storage device, e.g. a disk
  or magnetic tape. You may perform various device control functions. This
  monitor call is mainly used by the operating system itself. For more details,
  refer to the ND-100 SCSI Reference Guide, ND-12.048.

notes:
  - "With SINTRAN III/VSX, the monitor call and the parameters must reside on a fixed segment on protection ring 2. With SINTRAN III/VSE, the monitor call and parameters must reside in resident memory."
  - "The physical memory area must be contiguous. Older versions of magnetic tapes or disk controllers cannot cross physical memory bank boundaries of 128 Kbytes. These magnetic tapes have ND numbers less than ND-537. The disks have ND numbers less than ND-559."
  - "If you write code to be independent of whether it is run on SINTRAN III VSE or VSX, you are advised to use TransferData (EXABS, mon 335)."

see_also:
  - "TransferData"
  - "ReadFromFile"
  - "WriteToFile"

references:
  - "ND-100 SCSI Reference Guide (ND-12.048)"

parameters:
  - name: "DeviceNo"
    type: "INT"
    io: "I"
    description: "Logical device number. See appendix B."

  - name: "Func"
    type: "INT"
    io: "I"
    description: "Function code. See the tables on the following pages."

  - name: "MemoryAddr"
    type: "LONGINT"
    io: "I"
    description: "Physical memory address."

  - name: "BlockAddr"
    type: "INT"
    io: "I"
    description: "Block address on the disk. See the tables on the following pages."

  - name: "NoOfBlocks"
    type: "INT"
    io: "I"
    description: "Number of blocks to transfer."

  - name: "Stat"
    type: "INT"
    io: "O"
    description: "Error code. Negative if error. Contains a hardware status."

examples:
  pascal:
    available: true
    code: |
      DeviceNo, Func, BlockAddr, NoOfBlocks, Stat : INTEGER2;
      MemoryAddr : LONGINT;
      ...
      DataTransfer(DeviceNo, Func, MemoryAddr, BlockAddr, NoOfBlocks, Stat);
    notes: ""

  cobol:
    available: true
    code: |
      01 DeviceNo COMP.
      01 Func COMP.
      01 BlockAddr COMP.
      01 NoOfBlocks COMP.
      01 Stat COMP.
      01 MemoryAddr COMP PIC S9(10).
      ...
      MONITOR-CALL "DataTransfer" USING DeviceNo, Func, MemoryAddr, BlockAddr, NoOfBlocks, Stat.
    notes: ""

  fortran:
    available: true
    code: |
      INTEGER DeviceNo, Func, BlockAddr, NoOfBlocks, Stat
      INTEGER*4 MemoryAddr
      ...
      Monitor_Call('DataTransfer', DeviceNo, Func, MemoryAddr, BlockAddr, NoOfBlocks, Stat)
    notes: ""

  planc:
    available: true
    code: |
      INTEGER : DeviceNo, Func, BlockAddr, NoOfBlocks, Stat
      INTEGER4 : MemoryAddr

      Monitor_Call('DataTransfer', DeviceNo, Func, MemoryAddr, & BlockAddr, NoOfBlocks, Stat)
    notes: "Note the line continuation with &"

  assembly_500:
    available: true
    code: |
      DeviceNo : W BLOCK 1
      Func : W BLOCK 1
      MemoryAddr : W BLOCK 1  %ND-100 memory address.
      BlockAddr : W BLOCK 1
      NoOfBlocks : W BLOCK 1
      Stat : W BLOCK 1
      DataTransfer : EQU 37B9 + 131B

      CALLG DataTransfer, 5, DeviceNo, Func, MemoryAddr, &
      BlockAddr, NoOfBlocks

      IF K GO Error

      Error, W1 =: Stat
    octal_definition: "37B9 + 131B"
    notes: "Status returned in W1 register on error"

  mac:
    available: true
    code: |
      LDT   DEVNO %Logical device number.
      LDA   (PAR %Load register A with address of parameter list.
      MON   131 %Monitor call DataTransfer.
      JAN   ERROR %Error if register A is negative.

      %Continue with processing.
      %Error number in register A.

      DEVNO    ...
      PAR      FUNC %Function code etc.
      DMEM     %Memory address.
      BLOCK    %Block address.
      NOBLK    %Number of blocks to transfer.
    mon_number: 131
    notes: "Error indicated when register A is negative"

compatibility:
  platforms:
    nd100: true
    nd500: true

  users:
    - "All users"

  programs:
    - "RT programs"
    - "Background programs"
    - "System programs"

  notes: "Primarily used by operating system. VSX requires fixed segment on ring 2. VSE requires resident memory."

errors:
  returns_error: true
  error_codes: []
  error_reference: "Error code contains hardware status. Negative value indicates error."

source:
  document: "SINTRAN III Monitor Calls (ND-860228.2 EN)"
  page: 126
  line: 5377
  scan_date: "2020"
  scanned_by: "Jonny Oddene for Sintran Data"

extraction:
  date: "2025-01-06"
  version: "1.0"
  validated: false
  ocr_corrected: true
  ocr_notes: "Header was missing octal number - reconstructed from ASSEMBLY section"
